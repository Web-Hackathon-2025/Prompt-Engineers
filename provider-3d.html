<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Provider Dashboard - Karigar | Premium Service Marketplace</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Stylesheet -->
    <link rel="stylesheet" href="style-3d.css">
    
    <style>
        /* ===== PROVIDER DASHBOARD STYLES ===== */
        
        /* Dashboard Layout */
        .dashboard {
            min-height: 100vh;
            background: var(--surface-ground);
        }
        
        /* Dashboard Navigation */
        .dash-nav {
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-4) var(--space-8);
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--slate-100);
        }
        
        body.dark-mode .dash-nav {
            background: rgba(15, 23, 42, 0.9);
            border-bottom-color: var(--slate-800);
        }
        
        @media (max-width: 768px) {
            .dash-nav {
                padding: var(--space-3) var(--space-4);
            }
        }
        
        .dash-nav-left {
            display: flex;
            align-items: center;
            gap: var(--space-6);
        }
        
        .dash-brand {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            font-size: var(--text-xl);
            font-weight: 800;
            color: var(--slate-900);
        }
        
        body.dark-mode .dash-brand {
            color: var(--slate-50);
        }
        
        .dash-brand-icon {
            width: 40px;
            height: 40px;
            background: var(--gradient-primary);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--text-xl);
        }
        
        .nav-tabs {
            display: flex;
            gap: var(--space-1);
            background: var(--slate-100);
            padding: var(--space-1);
            border-radius: var(--radius-lg);
        }
        
        body.dark-mode .nav-tabs {
            background: var(--slate-800);
        }
        
        @media (max-width: 768px) {
            .nav-tabs {
                display: none;
            }
        }
        
        .nav-tab {
            padding: var(--space-2) var(--space-4);
            font-size: var(--text-sm);
            font-weight: 600;
            color: var(--slate-600);
            background: transparent;
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
        }
        
        .nav-tab.active {
            background: var(--surface-card);
            color: var(--primary-600);
            box-shadow: var(--shadow-sm);
        }
        
        .nav-tab:hover:not(.active) {
            color: var(--slate-900);
        }
        
        body.dark-mode .nav-tab.active {
            background: var(--slate-700);
            color: var(--primary-400);
        }
        
        /* Nav Right */
        .dash-nav-right {
            display: flex;
            align-items: center;
            gap: var(--space-4);
        }
        
        .nav-icon-btn {
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--slate-100);
            border: none;
            border-radius: var(--radius-lg);
            font-size: var(--text-xl);
            color: var(--slate-600);
            cursor: pointer;
            transition: all var(--transition-fast);
            position: relative;
        }
        
        .nav-icon-btn:hover {
            background: var(--slate-200);
            color: var(--slate-900);
        }
        
        body.dark-mode .nav-icon-btn {
            background: var(--slate-800);
            color: var(--slate-400);
        }
        
        body.dark-mode .nav-icon-btn:hover {
            background: var(--slate-700);
            color: var(--slate-100);
        }
        
        .nav-badge {
            position: absolute;
            top: -2px;
            right: -2px;
            min-width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--accent-500);
            color: white;
            font-size: 10px;
            font-weight: 700;
            border-radius: var(--radius-full);
            padding: 0 4px;
        }
        
        .user-avatar {
            width: 44px;
            height: 44px;
            background: var(--gradient-primary);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--text-lg);
            font-weight: 700;
            color: white;
            cursor: pointer;
        }
        
        /* Dashboard Content */
        .dash-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--space-8);
        }
        
        @media (max-width: 768px) {
            .dash-content {
                padding: var(--space-4);
            }
        }
        
        /* Provider Status Banner */
        .status-banner {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-4) var(--space-6);
            border-radius: var(--radius-xl);
            margin-bottom: var(--space-6);
        }
        
        .status-banner.pending {
            background: var(--accent-50);
            border: 1px solid var(--accent-200);
        }
        
        .status-banner.active {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        
        .status-banner-content {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }
        
        .status-banner-icon {
            font-size: 1.5rem;
        }
        
        .status-banner-text h3 {
            font-size: var(--text-base);
            font-weight: 600;
            color: var(--slate-900);
            margin-bottom: var(--space-1);
        }
        
        body.dark-mode .status-banner-text h3 {
            color: var(--slate-100);
        }
        
        .status-banner-text p {
            font-size: var(--text-sm);
            color: var(--slate-600);
        }
        
        /* Welcome Section */
        .welcome-section {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: var(--space-8);
        }
        
        @media (max-width: 768px) {
            .welcome-section {
                flex-direction: column;
                gap: var(--space-4);
            }
        }
        
        .welcome-text h1 {
            font-size: var(--text-2xl);
            font-weight: 700;
            color: var(--slate-900);
            margin-bottom: var(--space-1);
        }
        
        body.dark-mode .welcome-text h1 {
            color: var(--slate-50);
        }
        
        .welcome-text p {
            font-size: var(--text-base);
            color: var(--slate-500);
        }
        
        /* Availability Toggle */
        .availability-toggle {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-3) var(--space-5);
            background: var(--surface-card);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--slate-100);
        }
        
        body.dark-mode .availability-toggle {
            background: var(--slate-800);
            border-color: var(--slate-700);
        }
        
        .toggle-label {
            font-size: var(--text-sm);
            font-weight: 600;
            color: var(--slate-700);
        }
        
        body.dark-mode .toggle-label {
            color: var(--slate-300);
        }
        
        .toggle-switch {
            width: 52px;
            height: 28px;
            background: var(--slate-300);
            border-radius: var(--radius-full);
            position: relative;
            cursor: pointer;
            transition: all var(--transition-fast);
        }
        
        .toggle-switch.active {
            background: #10b981;
        }
        
        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 22px;
            height: 22px;
            background: white;
            border-radius: var(--radius-full);
            transition: all var(--transition-fast);
            box-shadow: var(--shadow-sm);
        }
        
        .toggle-switch.active::after {
            left: 27px;
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--space-5);
            margin-bottom: var(--space-8);
        }
        
        @media (max-width: 1024px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 640px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .stat-card {
            background: var(--surface-card);
            border-radius: var(--radius-2xl);
            padding: var(--space-6);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--slate-100);
            display: flex;
            align-items: flex-start;
            gap: var(--space-4);
            transition: all var(--transition-base);
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        body.dark-mode .stat-card {
            background: var(--surface-card);
            border-color: var(--slate-700);
        }
        
        .stat-icon {
            width: 56px;
            height: 56px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-xl);
            font-size: 1.5rem;
        }
        
        .stat-icon.primary {
            background: var(--primary-50);
            color: var(--primary-600);
        }
        
        .stat-icon.accent {
            background: var(--accent-100);
            color: var(--accent-600);
        }
        
        .stat-icon.success {
            background: rgba(16, 185, 129, 0.1);
            color: #10b981;
        }
        
        .stat-icon.warning {
            background: rgba(245, 158, 11, 0.1);
            color: #f59e0b;
        }
        
        body.dark-mode .stat-icon.primary {
            background: rgba(99, 102, 241, 0.15);
        }
        
        body.dark-mode .stat-icon.accent {
            background: rgba(245, 158, 11, 0.15);
        }
        
        .stat-info {
            flex: 1;
        }
        
        .stat-value {
            font-size: var(--text-2xl);
            font-weight: 800;
            color: var(--slate-900);
            margin-bottom: var(--space-1);
        }
        
        body.dark-mode .stat-value {
            color: var(--slate-50);
        }
        
        .stat-label {
            font-size: var(--text-sm);
            color: var(--slate-500);
        }
        
        /* Tab Panels */
        .tab-panel {
            display: none;
        }
        
        .tab-panel.active {
            display: block;
            animation: fadeIn 0.3s ease-out;
        }
        
        /* Section Header */
        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-5);
        }
        
        .section-title {
            font-size: var(--text-xl);
            font-weight: 700;
            color: var(--slate-900);
        }
        
        body.dark-mode .section-title {
            color: var(--slate-50);
        }
        
        /* Request Cards */
        .requests-grid {
            display: grid;
            gap: var(--space-4);
        }
        
        .request-card {
            background: var(--surface-card);
            border-radius: var(--radius-2xl);
            padding: var(--space-5);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--slate-100);
            transition: all var(--transition-base);
        }
        
        .request-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        body.dark-mode .request-card {
            background: var(--surface-card);
            border-color: var(--slate-700);
        }
        
        .request-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: var(--space-4);
        }
        
        .request-customer {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }
        
        .customer-avatar {
            width: 48px;
            height: 48px;
            background: var(--slate-200);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--text-lg);
            font-weight: 600;
            color: var(--slate-600);
        }
        
        body.dark-mode .customer-avatar {
            background: var(--slate-700);
            color: var(--slate-300);
        }
        
        .customer-info h4 {
            font-size: var(--text-base);
            font-weight: 600;
            color: var(--slate-900);
            margin-bottom: var(--space-1);
        }
        
        body.dark-mode .customer-info h4 {
            color: var(--slate-100);
        }
        
        .customer-info p {
            font-size: var(--text-sm);
            color: var(--slate-500);
        }
        
        .request-status {
            padding: var(--space-1) var(--space-3);
            border-radius: var(--radius-full);
            font-size: var(--text-xs);
            font-weight: 600;
        }
        
        .request-status.pending {
            background: var(--accent-100);
            color: var(--accent-700);
        }
        
        .request-status.accepted {
            background: rgba(16, 185, 129, 0.1);
            color: #059669;
        }
        
        .request-status.in-progress {
            background: rgba(59, 130, 246, 0.1);
            color: #2563eb;
        }
        
        .request-status.completed {
            background: rgba(16, 185, 129, 0.1);
            color: #059669;
        }
        
        .request-body {
            margin-bottom: var(--space-4);
        }
        
        .request-service {
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-2) var(--space-3);
            background: var(--primary-50);
            color: var(--primary-700);
            border-radius: var(--radius-lg);
            font-size: var(--text-sm);
            font-weight: 600;
            margin-bottom: var(--space-3);
        }
        
        body.dark-mode .request-service {
            background: rgba(99, 102, 241, 0.15);
            color: var(--primary-300);
        }
        
        .request-description {
            font-size: var(--text-sm);
            color: var(--slate-600);
            line-height: 1.6;
            margin-bottom: var(--space-3);
        }
        
        body.dark-mode .request-description {
            color: var(--slate-400);
        }
        
        .request-details {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--space-4);
            padding: var(--space-4);
            background: var(--slate-50);
            border-radius: var(--radius-lg);
        }
        
        body.dark-mode .request-details {
            background: var(--slate-800);
        }
        
        @media (max-width: 640px) {
            .request-details {
                grid-template-columns: 1fr;
                gap: var(--space-2);
            }
        }
        
        .detail-item {
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }
        
        .detail-icon {
            font-size: var(--text-lg);
        }
        
        .detail-text {
            font-size: var(--text-sm);
            color: var(--slate-600);
        }
        
        body.dark-mode .detail-text {
            color: var(--slate-400);
        }
        
        .request-footer {
            display: flex;
            gap: var(--space-3);
            padding-top: var(--space-4);
            border-top: 1px solid var(--slate-100);
        }
        
        body.dark-mode .request-footer {
            border-top-color: var(--slate-700);
        }
        
        .request-footer .btn {
            flex: 1;
        }
        
        /* Profile Card */
        .profile-card {
            background: var(--surface-card);
            border-radius: var(--radius-2xl);
            padding: var(--space-8);
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--slate-100);
            max-width: 600px;
        }
        
        body.dark-mode .profile-card {
            background: var(--surface-card);
            border-color: var(--slate-700);
        }
        
        .profile-header {
            display: flex;
            align-items: center;
            gap: var(--space-5);
            margin-bottom: var(--space-6);
            padding-bottom: var(--space-6);
            border-bottom: 1px solid var(--slate-100);
        }
        
        body.dark-mode .profile-header {
            border-bottom-color: var(--slate-700);
        }
        
        .profile-avatar {
            width: 80px;
            height: 80px;
            background: var(--gradient-primary);
            border-radius: var(--radius-2xl);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: 700;
            color: white;
        }
        
        .profile-info h2 {
            font-size: var(--text-xl);
            font-weight: 700;
            color: var(--slate-900);
            margin-bottom: var(--space-1);
        }
        
        body.dark-mode .profile-info h2 {
            color: var(--slate-50);
        }
        
        .profile-info p {
            font-size: var(--text-sm);
            color: var(--slate-500);
        }
        
        .profile-rating {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            margin-top: var(--space-2);
        }
        
        .rating-stars {
            color: var(--accent-500);
            font-size: var(--text-lg);
        }
        
        .rating-text {
            font-size: var(--text-sm);
            font-weight: 600;
            color: var(--slate-700);
        }
        
        body.dark-mode .rating-text {
            color: var(--slate-300);
        }
        
        /* Form elements */
        .form-group {
            margin-bottom: var(--space-5);
        }
        
        .form-label {
            display: block;
            font-size: var(--text-sm);
            font-weight: 600;
            color: var(--slate-700);
            margin-bottom: var(--space-2);
        }
        
        body.dark-mode .form-label {
            color: var(--slate-300);
        }
        
        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: var(--space-3) var(--space-4);
            font-size: var(--text-base);
            font-family: var(--font-body);
            color: var(--slate-900);
            background: var(--slate-50);
            border: 2px solid var(--slate-200);
            border-radius: var(--radius-lg);
            transition: all var(--transition-fast);
        }
        
        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary-500);
            background: var(--surface-card);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        }
        
        body.dark-mode .form-input,
        body.dark-mode .form-select,
        body.dark-mode .form-textarea {
            background: var(--slate-800);
            border-color: var(--slate-600);
            color: var(--slate-100);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-4);
        }
        
        @media (max-width: 640px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }
        
        /* Earnings Section */
        .earnings-summary {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--space-5);
            margin-bottom: var(--space-8);
        }
        
        @media (max-width: 768px) {
            .earnings-summary {
                grid-template-columns: 1fr;
            }
        }
        
        .earnings-card {
            background: var(--surface-card);
            border-radius: var(--radius-2xl);
            padding: var(--space-6);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--slate-100);
            text-align: center;
        }
        
        body.dark-mode .earnings-card {
            background: var(--surface-card);
            border-color: var(--slate-700);
        }
        
        .earnings-card.highlight {
            background: var(--gradient-primary);
            border: none;
            color: white;
        }
        
        .earnings-card.highlight .earnings-value,
        .earnings-card.highlight .earnings-label {
            color: white;
        }
        
        .earnings-value {
            font-size: var(--text-3xl);
            font-weight: 800;
            color: var(--slate-900);
            margin-bottom: var(--space-2);
        }
        
        body.dark-mode .earnings-value {
            color: var(--slate-50);
        }
        
        .earnings-label {
            font-size: var(--text-sm);
            color: var(--slate-500);
        }
        
        /* Empty state */
        .empty-state {
            text-align: center;
            padding: var(--space-12);
            background: var(--surface-card);
            border-radius: var(--radius-2xl);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--slate-100);
        }
        
        body.dark-mode .empty-state {
            background: var(--surface-card);
            border-color: var(--slate-700);
        }
        
        .empty-icon {
            font-size: 4rem;
            margin-bottom: var(--space-4);
        }
        
        .empty-title {
            font-size: var(--text-xl);
            font-weight: 600;
            color: var(--slate-700);
            margin-bottom: var(--space-2);
        }
        
        body.dark-mode .empty-title {
            color: var(--slate-300);
        }
        
        .empty-text {
            font-size: var(--text-base);
            color: var(--slate-500);
        }
        
        /* Toast notification */
        .toast {
            position: fixed;
            bottom: var(--space-6);
            right: var(--space-6);
            padding: var(--space-4) var(--space-6);
            background: var(--slate-900);
            color: white;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-xl);
            font-size: var(--text-sm);
            font-weight: 500;
            transform: translateY(100px);
            opacity: 0;
            transition: all var(--transition-base);
            z-index: 2000;
        }
        
        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        .toast.success {
            background: #059669;
        }
        
        .toast.error {
            background: #dc2626;
        }
        
        /* Hidden utility */
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <!-- ========== TOP NAVIGATION ========== -->
        <nav class="dash-nav">
            <div class="dash-nav-left">
                <a href="index-3d.html" class="dash-brand">
                    <span class="dash-brand-icon">üõ†Ô∏è</span>
                    <span>Karigar</span>
                </a>
                
                <div class="nav-tabs">
                    <button class="nav-tab active" onclick="switchTab('requests')">Requests</button>
                    <button class="nav-tab" onclick="switchTab('earnings')">Earnings</button>
                    <button class="nav-tab" onclick="switchTab('profile')">Profile</button>
                </div>
            </div>
            
            <div class="dash-nav-right">
                <button class="nav-icon-btn" id="darkModeToggle" title="Toggle Dark Mode">
                    <span id="darkModeIcon">üåô</span>
                </button>
                <button class="nav-icon-btn" title="Notifications">
                    <span>üîî</span>
                    <span class="nav-badge" id="notifCount">0</span>
                </button>
                <div class="user-avatar" id="userAvatar" title="Profile">P</div>
            </div>
        </nav>
        
        <!-- ========== MAIN CONTENT ========== -->
        <main class="dash-content">
            <!-- Status Banner (for pending providers) -->
            <div class="status-banner pending hidden" id="pendingBanner">
                <div class="status-banner-content">
                    <span class="status-banner-icon">‚è≥</span>
                    <div class="status-banner-text">
                        <h3>Profile Under Review</h3>
                        <p>Your account is pending admin approval. You'll be notified once approved.</p>
                    </div>
                </div>
            </div>
            
            <!-- Welcome Section -->
            <div class="welcome-section">
                <div class="welcome-text">
                    <h1 id="welcomeMessage">Welcome, Provider!</h1>
                    <p>Manage your service requests and grow your business</p>
                </div>
                <div class="availability-toggle">
                    <span class="toggle-label">Available for work</span>
                    <div class="toggle-switch active" id="availabilityToggle" onclick="toggleAvailability()"></div>
                </div>
            </div>
            
            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon primary">üì•</div>
                    <div class="stat-info">
                        <div class="stat-value" id="newRequests">0</div>
                        <div class="stat-label">New Requests</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon warning">üîÑ</div>
                    <div class="stat-info">
                        <div class="stat-value" id="activeJobs">0</div>
                        <div class="stat-label">Active Jobs</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon success">‚úÖ</div>
                    <div class="stat-info">
                        <div class="stat-value" id="completedJobs">0</div>
                        <div class="stat-label">Completed</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon accent">‚≠ê</div>
                    <div class="stat-info">
                        <div class="stat-value" id="rating">0.0</div>
                        <div class="stat-label">Rating</div>
                    </div>
                </div>
            </div>
            
            <!-- ===== REQUESTS TAB ===== -->
            <div class="tab-panel active" id="requestsTab">
                <div class="section-header">
                    <h2 class="section-title">Service Requests</h2>
                </div>
                
                <div class="requests-grid" id="requestsGrid">
                    <!-- Request cards loaded dynamically -->
                </div>
            </div>
            
            <!-- ===== EARNINGS TAB ===== -->
            <div class="tab-panel" id="earningsTab">
                <div class="earnings-summary">
                    <div class="earnings-card">
                        <div class="earnings-value" id="todayEarnings">‚Ç®0</div>
                        <div class="earnings-label">Today's Earnings</div>
                    </div>
                    <div class="earnings-card highlight">
                        <div class="earnings-value" id="totalEarnings">‚Ç®0</div>
                        <div class="earnings-label">Total Earnings</div>
                    </div>
                    <div class="earnings-card">
                        <div class="earnings-value" id="pendingPayments">‚Ç®0</div>
                        <div class="earnings-label">Pending Payments</div>
                    </div>
                </div>
                
                <div class="section-header">
                    <h2 class="section-title">Recent Transactions</h2>
                </div>
                
                <div class="requests-grid" id="transactionsGrid">
                    <!-- Transactions loaded dynamically -->
                </div>
            </div>
            
            <!-- ===== PROFILE TAB ===== -->
            <div class="tab-panel" id="profileTab">
                <div class="profile-card">
                    <div class="profile-header">
                        <div class="profile-avatar" id="profileAvatar">P</div>
                        <div class="profile-info">
                            <h2 id="profileName">Provider Name</h2>
                            <p id="profileService">Service Category</p>
                            <div class="profile-rating">
                                <span class="rating-stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
                                <span class="rating-text" id="profileRating">5.0 (0 reviews)</span>
                            </div>
                        </div>
                    </div>
                    
                    <form id="profileForm" onsubmit="updateProfile(event)">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Full Name</label>
                                <input type="text" class="form-input" id="editName" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Phone Number</label>
                                <input type="tel" class="form-input" id="editPhone" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Service Category</label>
                                <select class="form-select" id="editService" required>
                                    <option value="plumbing">Plumbing</option>
                                    <option value="electrical">Electrical</option>
                                    <option value="ac">AC & Cooling</option>
                                    <option value="carpentry">Carpentry</option>
                                    <option value="painting">Painting</option>
                                    <option value="cleaning">Cleaning</option>
                                    <option value="appliance">Appliance Repair</option>
                                    <option value="tutoring">Home Tutoring</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Hourly Rate (PKR)</label>
                                <input type="number" class="form-input" id="editRate" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Location</label>
                            <input type="text" class="form-input" id="editLocation" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">About</label>
                            <textarea class="form-textarea" id="editBio" placeholder="Tell customers about your experience and skills..."></textarea>
                        </div>
                        
                        <div style="display: flex; gap: var(--space-3);">
                            <button type="submit" class="btn btn-primary">Save Changes</button>
                            <button type="button" class="btn btn-secondary" onclick="logout()">Sign Out</button>
                        </div>
                    </form>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <!-- ========== FIREBASE ========== -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
        import { 
            getAuth, 
            signOut,
            onAuthStateChanged 
        } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js';
        import { 
            getFirestore, 
            collection,
            doc, 
            getDoc,
            getDocs,
            updateDoc,
            query,
            where,
            orderBy
        } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js';

        // Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyDxQpMjFN-_MxZpQCYKdCQzGOMxqdAQbcc",
            authDomain: "karigar-21ced.firebaseapp.com",
            projectId: "karigar-21ced",
            storageBucket: "karigar-21ced.firebasestorage.app",
            messagingSenderId: "1039416628498",
            appId: "1:1039416628498:web:5fc2c4e69c1eb87db34690"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        let currentUser = null;

        // Check auth state
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                const userDoc = await getDoc(doc(db, 'users', user.uid));
                if (userDoc.exists()) {
                    currentUser = { uid: user.uid, ...userDoc.data() };
                    
                    // Check if provider
                    if (currentUser.role !== 'provider') {
                        if (currentUser.role === 'customer') {
                            window.location.href = 'customer-3d.html';
                        } else if (currentUser.role === 'admin') {
                            window.location.href = 'admin-3d.html';
                        }
                        return;
                    }
                    
                    initDashboard();
                }
            } else {
                window.location.href = 'login-3d.html';
            }
        });
        
        // Initialize dashboard
        async function initDashboard() {
            // Check approval status
            if (currentUser.status === 'pending') {
                document.getElementById('pendingBanner').classList.remove('hidden');
            }
            
            // Set welcome message
            document.getElementById('welcomeMessage').textContent = 
                `Welcome, ${currentUser.name ? currentUser.name.split(' ')[0] : 'Provider'}!`;
            
            // Set user avatar
            if (currentUser.name) {
                const initial = currentUser.name.charAt(0).toUpperCase();
                document.getElementById('userAvatar').textContent = initial;
                document.getElementById('profileAvatar').textContent = initial;
            }
            
            // Set availability toggle
            const toggle = document.getElementById('availabilityToggle');
            if (currentUser.availability === 'available') {
                toggle.classList.add('active');
            } else {
                toggle.classList.remove('active');
            }
            
            // Load data
            await Promise.all([
                loadStats(),
                loadRequests(),
                loadProfile()
            ]);
        }
        
        // Load statistics
        async function loadStats() {
            try {
                const requestsQuery = query(
                    collection(db, 'serviceRequests'),
                    where('service', '==', currentUser.service)
                );
                
                const snapshot = await getDocs(requestsQuery);
                let newReqs = 0, active = 0, completed = 0;
                
                snapshot.forEach(doc => {
                    const data = doc.data();
                    if (data.status === 'pending') newReqs++;
                    if (data.status === 'accepted' || data.status === 'in-progress') active++;
                    if (data.status === 'completed' && data.providerId === currentUser.uid) completed++;
                });
                
                document.getElementById('newRequests').textContent = newReqs;
                document.getElementById('activeJobs').textContent = active;
                document.getElementById('completedJobs').textContent = completed;
                document.getElementById('rating').textContent = currentUser.rating || '5.0';
                document.getElementById('notifCount').textContent = newReqs;
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }
        
        // Load requests
        async function loadRequests() {
            try {
                const requestsQuery = query(
                    collection(db, 'serviceRequests'),
                    where('service', '==', currentUser.service)
                );
                
                const snapshot = await getDocs(requestsQuery);
                const container = document.getElementById('requestsGrid');
                container.innerHTML = '';
                
                if (snapshot.empty) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">üìã</div>
                            <div class="empty-title">No requests yet</div>
                            <div class="empty-text">New service requests in your category will appear here</div>
                        </div>
                    `;
                    return;
                }
                
                snapshot.forEach(docSnap => {
                    const request = { id: docSnap.id, ...docSnap.data() };
                    const card = createRequestCard(request);
                    container.appendChild(card);
                });
            } catch (error) {
                console.error('Error loading requests:', error);
            }
        }
        
        // Create request card
        function createRequestCard(request) {
            const card = document.createElement('div');
            card.className = 'request-card';
            card.innerHTML = `
                <div class="request-header">
                    <div class="request-customer">
                        <div class="customer-avatar">${request.customerName ? request.customerName.charAt(0).toUpperCase() : 'C'}</div>
                        <div class="customer-info">
                            <h4>${request.customerName || 'Customer'}</h4>
                            <p>üìç ${request.address || 'No address'}</p>
                        </div>
                    </div>
                    <span class="request-status ${request.status}">${formatStatus(request.status)}</span>
                </div>
                <div class="request-body">
                    <div class="request-service">
                        ${getServiceIcon(request.service)} ${formatService(request.service)}
                    </div>
                    <p class="request-description">${request.description || 'No description provided'}</p>
                    <div class="request-details">
                        <div class="detail-item">
                            <span class="detail-icon">üìÖ</span>
                            <span class="detail-text">${formatDate(request.preferredDate)}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-icon">üïê</span>
                            <span class="detail-text">${formatTime(request.preferredTime)}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-icon">üí∞</span>
                            <span class="detail-text">‚Ç®${request.budget || 'Negotiable'}</span>
                        </div>
                    </div>
                </div>
                <div class="request-footer">
                    ${getActionButtons(request)}
                </div>
            `;
            return card;
        }
        
        // Get action buttons based on status
        function getActionButtons(request) {
            if (request.status === 'pending') {
                return `
                    <button class="btn btn-primary" onclick="acceptRequest('${request.id}')">Accept Job</button>
                    <button class="btn btn-secondary" onclick="declineRequest('${request.id}')">Decline</button>
                `;
            } else if (request.status === 'accepted' && request.providerId === currentUser.uid) {
                return `
                    <button class="btn btn-primary" onclick="startJob('${request.id}')">Start Work</button>
                    <button class="btn btn-secondary">Contact Customer</button>
                `;
            } else if (request.status === 'in-progress' && request.providerId === currentUser.uid) {
                return `
                    <button class="btn btn-primary" onclick="completeJob('${request.id}')">Mark Complete</button>
                    <button class="btn btn-secondary">Contact Customer</button>
                `;
            } else if (request.providerId && request.providerId !== currentUser.uid) {
                return `<button class="btn btn-secondary" disabled>Taken by another provider</button>`;
            }
            return '';
        }
        
        // Accept request
        window.acceptRequest = async function(requestId) {
            try {
                await updateDoc(doc(db, 'serviceRequests', requestId), {
                    status: 'accepted',
                    providerId: currentUser.uid,
                    providerName: currentUser.name,
                    acceptedAt: new Date().toISOString()
                });
                showToast('Job accepted successfully!', 'success');
                loadRequests();
                loadStats();
            } catch (error) {
                console.error('Error accepting request:', error);
                showToast('Failed to accept job', 'error');
            }
        };
        
        // Decline request
        window.declineRequest = async function(requestId) {
            showToast('Request declined', 'success');
        };
        
        // Start job
        window.startJob = async function(requestId) {
            try {
                await updateDoc(doc(db, 'serviceRequests', requestId), {
                    status: 'in-progress',
                    startedAt: new Date().toISOString()
                });
                showToast('Job started!', 'success');
                loadRequests();
                loadStats();
            } catch (error) {
                console.error('Error starting job:', error);
                showToast('Failed to start job', 'error');
            }
        };
        
        // Complete job
        window.completeJob = async function(requestId) {
            try {
                await updateDoc(doc(db, 'serviceRequests', requestId), {
                    status: 'completed',
                    completedAt: new Date().toISOString()
                });
                showToast('Job completed! üéâ', 'success');
                loadRequests();
                loadStats();
            } catch (error) {
                console.error('Error completing job:', error);
                showToast('Failed to complete job', 'error');
            }
        };
        
        // Load profile
        function loadProfile() {
            document.getElementById('profileName').textContent = currentUser.name || 'Provider';
            document.getElementById('profileService').textContent = formatService(currentUser.service);
            document.getElementById('profileRating').textContent = 
                `${currentUser.rating || '5.0'} (${currentUser.reviewCount || 0} reviews)`;
            
            // Fill form
            document.getElementById('editName').value = currentUser.name || '';
            document.getElementById('editPhone').value = currentUser.phone || '';
            document.getElementById('editService').value = currentUser.service || '';
            document.getElementById('editRate').value = currentUser.rate || '';
            document.getElementById('editLocation').value = currentUser.location || '';
            document.getElementById('editBio').value = currentUser.bio || '';
        }
        
        // Update profile
        window.updateProfile = async function(event) {
            event.preventDefault();
            
            const updates = {
                name: document.getElementById('editName').value,
                phone: document.getElementById('editPhone').value,
                service: document.getElementById('editService').value,
                rate: document.getElementById('editRate').value,
                location: document.getElementById('editLocation').value,
                bio: document.getElementById('editBio').value
            };
            
            try {
                await updateDoc(doc(db, 'users', currentUser.uid), updates);
                await updateDoc(doc(db, 'providers', currentUser.uid), updates);
                
                currentUser = { ...currentUser, ...updates };
                showToast('Profile updated successfully!', 'success');
                loadProfile();
            } catch (error) {
                console.error('Error updating profile:', error);
                showToast('Failed to update profile', 'error');
            }
        };
        
        // Toggle availability
        window.toggleAvailability = async function() {
            const toggle = document.getElementById('availabilityToggle');
            const newStatus = toggle.classList.contains('active') ? 'unavailable' : 'available';
            
            try {
                await updateDoc(doc(db, 'users', currentUser.uid), {
                    availability: newStatus
                });
                await updateDoc(doc(db, 'providers', currentUser.uid), {
                    availability: newStatus
                });
                
                toggle.classList.toggle('active');
                currentUser.availability = newStatus;
                showToast(`You are now ${newStatus === 'available' ? 'available' : 'unavailable'} for work`, 'success');
            } catch (error) {
                console.error('Error updating availability:', error);
                showToast('Failed to update availability', 'error');
            }
        };
        
        // Tab switching
        window.switchTab = function(tab) {
            // Update nav tabs
            document.querySelectorAll('.nav-tab').forEach((t, i) => {
                t.classList.remove('active');
                if ((tab === 'requests' && i === 0) || 
                    (tab === 'earnings' && i === 1) || 
                    (tab === 'profile' && i === 2)) {
                    t.classList.add('active');
                }
            });
            
            // Update panels
            document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
            document.getElementById(tab + 'Tab').classList.add('active');
        };
        
        // Format helpers
        function formatService(service) {
            const services = {
                plumbing: 'Plumbing',
                electrical: 'Electrical',
                ac: 'AC & Cooling',
                carpentry: 'Carpentry',
                painting: 'Painting',
                cleaning: 'Cleaning',
                appliance: 'Appliance Repair',
                tutoring: 'Home Tutoring',
                other: 'Other Service'
            };
            return services[service] || service || 'Service';
        }
        
        function getServiceIcon(service) {
            const icons = {
                plumbing: 'üîß',
                electrical: '‚ö°',
                ac: '‚ùÑÔ∏è',
                carpentry: 'ü™ö',
                painting: 'üé®',
                cleaning: 'üßπ',
                appliance: 'üì∫',
                tutoring: 'üìö',
                other: 'üõ†Ô∏è'
            };
            return icons[service] || 'üõ†Ô∏è';
        }
        
        function formatStatus(status) {
            const statuses = {
                pending: 'Pending',
                accepted: 'Accepted',
                'in-progress': 'In Progress',
                completed: 'Completed',
                cancelled: 'Cancelled'
            };
            return statuses[status] || status;
        }
        
        function formatDate(date) {
            if (!date) return 'Not set';
            return new Date(date).toLocaleDateString('en-PK', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }
        
        function formatTime(time) {
            const times = {
                morning: 'Morning (8AM-12PM)',
                afternoon: 'Afternoon (12PM-5PM)',
                evening: 'Evening (5PM-9PM)'
            };
            return times[time] || time || 'Flexible';
        }
        
        // Logout
        window.logout = async function() {
            try {
                await signOut(auth);
                localStorage.removeItem('currentUser');
                window.location.href = 'login-3d.html';
            } catch (error) {
                console.error('Logout error:', error);
            }
        };
        
        // Toast notification
        window.showToast = function(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type} show`;
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        };
        
        // Dark mode toggle
        document.getElementById('darkModeToggle').addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('darkMode', isDark ? 'enabled' : 'disabled');
            document.getElementById('darkModeIcon').textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
        });
        
        // Check saved dark mode preference
        if (localStorage.getItem('darkMode') === 'enabled') {
            document.body.classList.add('dark-mode');
            document.getElementById('darkModeIcon').textContent = '‚òÄÔ∏è';
        }
    </script>
    
    <!-- Page Transitions -->
    <script src="page-transitions.js"></script>
</body>
</html>
