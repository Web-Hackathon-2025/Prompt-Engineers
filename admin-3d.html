<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Karigar | Premium Service Marketplace</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Stylesheet -->
    <link rel="stylesheet" href="style-3d.css">
    
    <style>
        /* ===== ADMIN DASHBOARD STYLES ===== */
        
        /* Admin Layout */
        .admin-layout {
            display: grid;
            grid-template-columns: 260px 1fr;
            min-height: 100vh;
        }
        
        @media (max-width: 1024px) {
            .admin-layout {
                grid-template-columns: 1fr;
            }
        }
        
        /* Sidebar */
        .admin-sidebar {
            background: var(--slate-900);
            padding: var(--space-6);
            display: flex;
            flex-direction: column;
            position: sticky;
            top: 0;
            height: 100vh;
        }
        
        @media (max-width: 1024px) {
            .admin-sidebar {
                display: none;
            }
        }
        
        .sidebar-brand {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding-bottom: var(--space-6);
            border-bottom: 1px solid var(--slate-700);
            margin-bottom: var(--space-6);
        }
        
        .sidebar-brand-icon {
            width: 44px;
            height: 44px;
            background: var(--gradient-primary);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--text-xl);
        }
        
        .sidebar-brand-text {
            color: white;
        }
        
        .sidebar-brand-text h1 {
            font-size: var(--text-xl);
            font-weight: 800;
        }
        
        .sidebar-brand-text span {
            font-size: var(--text-xs);
            color: var(--slate-400);
            font-weight: 500;
        }
        
        /* Sidebar Navigation */
        .sidebar-nav {
            flex: 1;
        }
        
        .nav-section {
            margin-bottom: var(--space-6);
        }
        
        .nav-section-title {
            font-size: var(--text-xs);
            font-weight: 600;
            color: var(--slate-500);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: var(--space-3);
            padding-left: var(--space-3);
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-3) var(--space-4);
            border-radius: var(--radius-lg);
            color: var(--slate-400);
            font-size: var(--text-sm);
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-fast);
            margin-bottom: var(--space-1);
        }
        
        .nav-item:hover {
            background: var(--slate-800);
            color: white;
        }
        
        .nav-item.active {
            background: var(--primary-600);
            color: white;
        }
        
        .nav-item-icon {
            font-size: var(--text-lg);
        }
        
        .nav-item-badge {
            margin-left: auto;
            min-width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--accent-500);
            color: white;
            font-size: 10px;
            font-weight: 700;
            border-radius: var(--radius-full);
            padding: 0 6px;
        }
        
        /* Sidebar Footer */
        .sidebar-footer {
            padding-top: var(--space-4);
            border-top: 1px solid var(--slate-700);
        }
        
        .sidebar-user {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-3);
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all var(--transition-fast);
        }
        
        .sidebar-user:hover {
            background: var(--slate-800);
        }
        
        .sidebar-avatar {
            width: 40px;
            height: 40px;
            background: var(--gradient-primary);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--text-base);
            font-weight: 700;
            color: white;
        }
        
        .sidebar-user-info {
            flex: 1;
            min-width: 0;
        }
        
        .sidebar-user-info h4 {
            font-size: var(--text-sm);
            font-weight: 600;
            color: white;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .sidebar-user-info p {
            font-size: var(--text-xs);
            color: var(--slate-400);
        }
        
        /* Main Content */
        .admin-main {
            background: var(--surface-ground);
            min-height: 100vh;
        }
        
        /* Top Header */
        .admin-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-4) var(--space-8);
            background: var(--surface-card);
            border-bottom: 1px solid var(--slate-100);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        body.dark-mode .admin-header {
            background: var(--slate-900);
            border-bottom-color: var(--slate-800);
        }
        
        @media (max-width: 768px) {
            .admin-header {
                padding: var(--space-3) var(--space-4);
            }
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: var(--space-4);
        }
        
        .mobile-menu-btn {
            display: none;
            width: 44px;
            height: 44px;
            align-items: center;
            justify-content: center;
            background: var(--slate-100);
            border: none;
            border-radius: var(--radius-lg);
            font-size: var(--text-xl);
            cursor: pointer;
        }
        
        @media (max-width: 1024px) {
            .mobile-menu-btn {
                display: flex;
            }
        }
        
        body.dark-mode .mobile-menu-btn {
            background: var(--slate-800);
        }
        
        .page-title {
            font-size: var(--text-xl);
            font-weight: 700;
            color: var(--slate-900);
        }
        
        body.dark-mode .page-title {
            color: var(--slate-50);
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }
        
        .header-btn {
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--slate-100);
            border: none;
            border-radius: var(--radius-lg);
            font-size: var(--text-xl);
            color: var(--slate-600);
            cursor: pointer;
            transition: all var(--transition-fast);
            position: relative;
        }
        
        .header-btn:hover {
            background: var(--slate-200);
            color: var(--slate-900);
        }
        
        body.dark-mode .header-btn {
            background: var(--slate-800);
            color: var(--slate-400);
        }
        
        body.dark-mode .header-btn:hover {
            background: var(--slate-700);
            color: var(--slate-100);
        }
        
        .header-badge {
            position: absolute;
            top: -2px;
            right: -2px;
            min-width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--accent-500);
            color: white;
            font-size: 10px;
            font-weight: 700;
            border-radius: var(--radius-full);
            padding: 0 4px;
        }
        
        /* Content Area */
        .admin-content {
            padding: var(--space-8);
        }
        
        @media (max-width: 768px) {
            .admin-content {
                padding: var(--space-4);
            }
        }
        
        /* Overview Stats */
        .overview-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--space-5);
            margin-bottom: var(--space-8);
        }
        
        @media (max-width: 1200px) {
            .overview-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 640px) {
            .overview-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .overview-card {
            background: var(--surface-card);
            border-radius: var(--radius-2xl);
            padding: var(--space-6);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--slate-100);
            transition: all var(--transition-base);
        }
        
        .overview-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        body.dark-mode .overview-card {
            background: var(--surface-card);
            border-color: var(--slate-700);
        }
        
        .overview-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-4);
        }
        
        .overview-icon {
            width: 52px;
            height: 52px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-xl);
            font-size: 1.5rem;
        }
        
        .overview-icon.primary {
            background: var(--primary-50);
            color: var(--primary-600);
        }
        
        .overview-icon.success {
            background: rgba(16, 185, 129, 0.1);
            color: #10b981;
        }
        
        .overview-icon.warning {
            background: rgba(245, 158, 11, 0.1);
            color: #f59e0b;
        }
        
        .overview-icon.accent {
            background: var(--accent-100);
            color: var(--accent-600);
        }
        
        body.dark-mode .overview-icon.primary {
            background: rgba(99, 102, 241, 0.15);
        }
        
        .overview-trend {
            display: flex;
            align-items: center;
            gap: var(--space-1);
            font-size: var(--text-sm);
            font-weight: 600;
        }
        
        .overview-trend.up {
            color: #10b981;
        }
        
        .overview-trend.down {
            color: #ef4444;
        }
        
        .overview-value {
            font-size: var(--text-3xl);
            font-weight: 800;
            color: var(--slate-900);
            margin-bottom: var(--space-1);
        }
        
        body.dark-mode .overview-value {
            color: var(--slate-50);
        }
        
        .overview-label {
            font-size: var(--text-sm);
            color: var(--slate-500);
        }
        
        /* Tab Panels */
        .tab-panel {
            display: none;
        }
        
        .tab-panel.active {
            display: block;
            animation: fadeIn 0.3s ease-out;
        }
        
        /* Section Header */
        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-5);
        }
        
        .section-title {
            font-size: var(--text-xl);
            font-weight: 700;
            color: var(--slate-900);
        }
        
        body.dark-mode .section-title {
            color: var(--slate-50);
        }
        
        .section-actions {
            display: flex;
            gap: var(--space-3);
        }
        
        /* Data Table */
        .data-table-card {
            background: var(--surface-card);
            border-radius: var(--radius-2xl);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--slate-100);
            overflow: hidden;
        }
        
        body.dark-mode .data-table-card {
            background: var(--surface-card);
            border-color: var(--slate-700);
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .data-table th {
            padding: var(--space-4) var(--space-5);
            text-align: left;
            font-size: var(--text-sm);
            font-weight: 600;
            color: var(--slate-600);
            background: var(--slate-50);
            border-bottom: 1px solid var(--slate-100);
        }
        
        body.dark-mode .data-table th {
            background: var(--slate-800);
            color: var(--slate-300);
            border-bottom-color: var(--slate-700);
        }
        
        .data-table td {
            padding: var(--space-4) var(--space-5);
            font-size: var(--text-sm);
            color: var(--slate-700);
            border-bottom: 1px solid var(--slate-100);
        }
        
        body.dark-mode .data-table td {
            color: var(--slate-300);
            border-bottom-color: var(--slate-700);
        }
        
        .data-table tr:last-child td {
            border-bottom: none;
        }
        
        .data-table tr:hover td {
            background: var(--slate-50);
        }
        
        body.dark-mode .data-table tr:hover td {
            background: var(--slate-800);
        }
        
        /* User Cell */
        .user-cell {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            background: var(--gradient-primary);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--text-sm);
            font-weight: 700;
            color: white;
        }
        
        .user-info h4 {
            font-size: var(--text-sm);
            font-weight: 600;
            color: var(--slate-900);
        }
        
        body.dark-mode .user-info h4 {
            color: var(--slate-100);
        }
        
        .user-info p {
            font-size: var(--text-xs);
            color: var(--slate-500);
        }
        
        /* Status Badges */
        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: var(--space-1) var(--space-3);
            border-radius: var(--radius-full);
            font-size: var(--text-xs);
            font-weight: 600;
        }
        
        .status-badge.pending {
            background: var(--accent-100);
            color: var(--accent-700);
        }
        
        .status-badge.active {
            background: rgba(16, 185, 129, 0.1);
            color: #059669;
        }
        
        .status-badge.inactive {
            background: var(--slate-100);
            color: var(--slate-600);
        }
        
        .status-badge.rejected {
            background: rgba(239, 68, 68, 0.1);
            color: #dc2626;
        }
        
        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: var(--space-2);
        }
        
        .action-btn {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--slate-100);
            border: none;
            border-radius: var(--radius-md);
            font-size: var(--text-lg);
            cursor: pointer;
            transition: all var(--transition-fast);
        }
        
        .action-btn:hover {
            background: var(--slate-200);
        }
        
        .action-btn.approve {
            background: rgba(16, 185, 129, 0.1);
            color: #059669;
        }
        
        .action-btn.approve:hover {
            background: rgba(16, 185, 129, 0.2);
        }
        
        .action-btn.reject {
            background: rgba(239, 68, 68, 0.1);
            color: #dc2626;
        }
        
        .action-btn.reject:hover {
            background: rgba(239, 68, 68, 0.2);
        }
        
        body.dark-mode .action-btn {
            background: var(--slate-700);
            color: var(--slate-300);
        }
        
        body.dark-mode .action-btn:hover {
            background: var(--slate-600);
        }
        
        /* Empty state */
        .empty-state {
            text-align: center;
            padding: var(--space-12);
        }
        
        .empty-icon {
            font-size: 4rem;
            margin-bottom: var(--space-4);
        }
        
        .empty-title {
            font-size: var(--text-xl);
            font-weight: 600;
            color: var(--slate-700);
            margin-bottom: var(--space-2);
        }
        
        body.dark-mode .empty-title {
            color: var(--slate-300);
        }
        
        .empty-text {
            font-size: var(--text-base);
            color: var(--slate-500);
        }
        
        /* Cards Grid */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-5);
        }
        
        @media (max-width: 1024px) {
            .cards-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Approval Card */
        .approval-card {
            background: var(--surface-card);
            border-radius: var(--radius-2xl);
            padding: var(--space-5);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--slate-100);
            transition: all var(--transition-base);
        }
        
        .approval-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        body.dark-mode .approval-card {
            background: var(--surface-card);
            border-color: var(--slate-700);
        }
        
        .approval-header {
            display: flex;
            align-items: center;
            gap: var(--space-4);
            margin-bottom: var(--space-4);
        }
        
        .approval-avatar {
            width: 56px;
            height: 56px;
            background: var(--gradient-primary);
            border-radius: var(--radius-xl);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--text-xl);
            font-weight: 700;
            color: white;
        }
        
        .approval-info {
            flex: 1;
        }
        
        .approval-info h4 {
            font-size: var(--text-base);
            font-weight: 600;
            color: var(--slate-900);
            margin-bottom: var(--space-1);
        }
        
        body.dark-mode .approval-info h4 {
            color: var(--slate-100);
        }
        
        .approval-info p {
            font-size: var(--text-sm);
            color: var(--slate-500);
        }
        
        .approval-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-3);
            padding: var(--space-4);
            background: var(--slate-50);
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-4);
        }
        
        body.dark-mode .approval-details {
            background: var(--slate-800);
        }
        
        .detail-item {
            display: flex;
            flex-direction: column;
            gap: var(--space-1);
        }
        
        .detail-label {
            font-size: var(--text-xs);
            color: var(--slate-500);
        }
        
        .detail-value {
            font-size: var(--text-sm);
            font-weight: 600;
            color: var(--slate-700);
        }
        
        body.dark-mode .detail-value {
            color: var(--slate-300);
        }
        
        .approval-actions {
            display: flex;
            gap: var(--space-3);
        }
        
        .approval-actions .btn {
            flex: 1;
        }
        
        /* Toast notification */
        .toast {
            position: fixed;
            bottom: var(--space-6);
            right: var(--space-6);
            padding: var(--space-4) var(--space-6);
            background: var(--slate-900);
            color: white;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-xl);
            font-size: var(--text-sm);
            font-weight: 500;
            transform: translateY(100px);
            opacity: 0;
            transition: all var(--transition-base);
            z-index: 2000;
        }
        
        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        .toast.success {
            background: #059669;
        }
        
        .toast.error {
            background: #dc2626;
        }
        
        /* Hidden utility */
        .hidden {
            display: none !important;
        }
        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--slate-900);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            transition: opacity 0.3s ease;
        }
        
        .loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(99, 102, 241, 0.1);
            border-top-color: var(--primary-500);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        .loading-text {
            margin-top: var(--space-4);
            color: var(--slate-400);
            font-size: var(--text-sm);
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .admin-layout.loading {
            opacity: 0;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-spinner"></div>
        <div class="loading-text">Verifying admin access...</div>
    </div>
    
    <div class="admin-layout loading" id="adminLayout">
        <!-- ========== SIDEBAR ========== -->
        <aside class="admin-sidebar">
            <div class="sidebar-brand">
                <span class="sidebar-brand-icon">üõ†Ô∏è</span>
                <div class="sidebar-brand-text">
                    <h1>Karigar</h1>
                    <span>Admin Panel</span>
                </div>
            </div>
            
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Overview</div>
                    <div class="nav-item active" onclick="switchTab('dashboard')">
                        <span class="nav-item-icon">üìä</span>
                        <span>Dashboard</span>
                    </div>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">Management</div>
                    <div class="nav-item" onclick="switchTab('providers')">
                        <span class="nav-item-icon">üë∑</span>
                        <span>Providers</span>
                        <span class="nav-item-badge" id="pendingBadge">0</span>
                    </div>
                    <div class="nav-item" onclick="switchTab('customers')">
                        <span class="nav-item-icon">üë§</span>
                        <span>Customers</span>
                    </div>
                    <div class="nav-item" onclick="switchTab('requests')">
                        <span class="nav-item-icon">üìã</span>
                        <span>Requests</span>
                    </div>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">System</div>
                    <div class="nav-item" onclick="switchTab('settings')">
                        <span class="nav-item-icon">‚öôÔ∏è</span>
                        <span>Settings</span>
                    </div>
                </div>
            </nav>
            
            <div class="sidebar-footer">
                <div class="sidebar-user" onclick="logout()">
                    <div class="sidebar-avatar" id="sidebarAvatar">A</div>
                    <div class="sidebar-user-info">
                        <h4 id="sidebarName">Admin</h4>
                        <p>Sign Out</p>
                    </div>
                </div>
            </div>
        </aside>
        
        <!-- ========== MAIN CONTENT ========== -->
        <main class="admin-main">
            <!-- Header -->
            <header class="admin-header">
                <div class="header-left">
                    <button class="mobile-menu-btn">‚ò∞</button>
                    <h1 class="page-title" id="pageTitle">Dashboard</h1>
                </div>
                <div class="header-right">
                    <button class="header-btn" id="darkModeToggle" title="Toggle Dark Mode">
                        <span id="darkModeIcon">üåô</span>
                    </button>
                    <button class="header-btn" title="Notifications">
                        <span>üîî</span>
                        <span class="header-badge" id="headerBadge">0</span>
                    </button>
                </div>
            </header>
            
            <!-- Content -->
            <div class="admin-content">
                <!-- ===== DASHBOARD TAB ===== -->
                <div class="tab-panel active" id="dashboardTab">
                    <!-- Overview Stats -->
                    <div class="overview-grid">
                        <div class="overview-card">
                            <div class="overview-header">
                                <div class="overview-icon primary">üë§</div>
                                <span class="overview-trend up">‚Üë 12%</span>
                            </div>
                            <div class="overview-value" id="totalUsers">0</div>
                            <div class="overview-label">Total Users</div>
                        </div>
                        <div class="overview-card">
                            <div class="overview-header">
                                <div class="overview-icon success">üë∑</div>
                                <span class="overview-trend up">‚Üë 8%</span>
                            </div>
                            <div class="overview-value" id="totalProviders">0</div>
                            <div class="overview-label">Active Providers</div>
                        </div>
                        <div class="overview-card">
                            <div class="overview-header">
                                <div class="overview-icon warning">üìã</div>
                                <span class="overview-trend up">‚Üë 24%</span>
                            </div>
                            <div class="overview-value" id="totalRequests">0</div>
                            <div class="overview-label">Service Requests</div>
                        </div>
                        <div class="overview-card">
                            <div class="overview-header">
                                <div class="overview-icon accent">‚è≥</div>
                            </div>
                            <div class="overview-value" id="pendingApprovals">0</div>
                            <div class="overview-label">Pending Approvals</div>
                        </div>
                    </div>
                    
                    <!-- Pending Approvals -->
                    <div class="section-header">
                        <h2 class="section-title">Pending Provider Approvals</h2>
                    </div>
                    <div class="cards-grid" id="pendingApprovalCards">
                        <!-- Approval cards loaded dynamically -->
                    </div>
                </div>
                
                <!-- ===== PROVIDERS TAB ===== -->
                <div class="tab-panel" id="providersTab">
                    <div class="section-header">
                        <h2 class="section-title">All Service Providers</h2>
                    </div>
                    <div class="data-table-card">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Provider</th>
                                    <th>Service</th>
                                    <th>Location</th>
                                    <th>Rating</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="providersTable">
                                <!-- Provider rows loaded dynamically -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- ===== CUSTOMERS TAB ===== -->
                <div class="tab-panel" id="customersTab">
                    <div class="section-header">
                        <h2 class="section-title">All Customers</h2>
                    </div>
                    <div class="data-table-card">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Customer</th>
                                    <th>Location</th>
                                    <th>Requests</th>
                                    <th>Joined</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="customersTable">
                                <!-- Customer rows loaded dynamically -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- ===== REQUESTS TAB ===== -->
                <div class="tab-panel" id="requestsTab">
                    <div class="section-header">
                        <h2 class="section-title">All Service Requests</h2>
                    </div>
                    <div class="data-table-card">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Customer</th>
                                    <th>Service</th>
                                    <th>Provider</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="requestsTable">
                                <!-- Request rows loaded dynamically -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- ===== SETTINGS TAB ===== -->
                <div class="tab-panel" id="settingsTab">
                    <div class="section-header">
                        <h2 class="section-title">System Settings</h2>
                    </div>
                    <div class="approval-card" style="max-width: 600px;">
                        <h3 style="font-size: var(--text-lg); font-weight: 600; color: var(--slate-900); margin-bottom: var(--space-4);">
                            Platform Settings
                        </h3>
                        <p style="color: var(--slate-500); font-size: var(--text-sm); margin-bottom: var(--space-4);">
                            Configure platform-wide settings and preferences.
                        </p>
                        <div class="approval-details">
                            <div class="detail-item">
                                <span class="detail-label">Platform Version</span>
                                <span class="detail-value">Karigar v1.0.0</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Database</span>
                                <span class="detail-value">Firebase Firestore</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Auth Provider</span>
                                <span class="detail-value">Firebase Auth</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Last Updated</span>
                                <span class="detail-value">January 2025</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <!-- ========== FIREBASE ========== -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
        import { 
            getAuth, 
            signOut,
            onAuthStateChanged 
        } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js';
        import { 
            getFirestore, 
            collection,
            doc, 
            getDoc,
            getDocs,
            updateDoc,
            deleteDoc,
            query,
            where,
            orderBy
        } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js';

        // Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyAhUUt_I_E9DW0qCn7XMQyO7aJv-GyEYCI",
            authDomain: "karigar-21ced.firebaseapp.com",
            projectId: "karigar-21ced",
            storageBucket: "karigar-21ced.firebasestorage.app",
            messagingSenderId: "927258761848",
            appId: "1:927258761848:web:cd33800a11401248ddab8d",
            measurementId: "G-4ZWE0SXT1S"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        let currentUser = null;

        // Check auth state
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                try {
                    const userDoc = await getDoc(doc(db, 'users', user.uid));
                    if (userDoc.exists()) {
                        currentUser = { uid: user.uid, ...userDoc.data() };
                        
                        // Check if admin
                        if (currentUser.role !== 'admin') {
                            console.log('User is not admin, redirecting...');
                            if (currentUser.role === 'customer') {
                                window.location.href = 'customer-3d.html';
                            } else if (currentUser.role === 'provider') {
                                window.location.href = 'provider-3d.html';
                            } else {
                                window.location.href = 'login-3d.html';
                            }
                            return;
                        }
                        
                        // User is admin - show the dashboard
                        document.getElementById('loadingScreen').classList.add('hidden');
                        document.getElementById('adminLayout').classList.remove('loading');
                        initDashboard();
                    } else {
                        // User document doesn't exist
                        window.location.href = 'login-3d.html';
                    }
                } catch (error) {
                    console.error('Error checking user role:', error);
                    window.location.href = 'login-3d.html';
                }
            } else {
                // Not logged in
                window.location.href = 'login-3d.html';
            }
        });
        
        // Initialize dashboard
        async function initDashboard() {
            // Set admin info
            if (currentUser.name) {
                document.getElementById('sidebarName').textContent = currentUser.name;
                document.getElementById('sidebarAvatar').textContent = currentUser.name.charAt(0).toUpperCase();
            }
            
            // Load data
            await Promise.all([
                loadOverviewStats(),
                loadPendingApprovals(),
                loadProviders(),
                loadCustomers(),
                loadRequests()
            ]);
        }
        
        // Load overview statistics
        async function loadOverviewStats() {
            try {
                // Count users
                const usersSnapshot = await getDocs(collection(db, 'users'));
                document.getElementById('totalUsers').textContent = usersSnapshot.size;
                
                // Count active providers
                const providersQuery = query(
                    collection(db, 'providers'),
                    where('status', '==', 'active')
                );
                const providersSnapshot = await getDocs(providersQuery);
                document.getElementById('totalProviders').textContent = providersSnapshot.size;
                
                // Count requests
                const requestsSnapshot = await getDocs(collection(db, 'serviceRequests'));
                document.getElementById('totalRequests').textContent = requestsSnapshot.size;
                
                // Count pending approvals
                const pendingQuery = query(
                    collection(db, 'providers'),
                    where('status', '==', 'pending')
                );
                const pendingSnapshot = await getDocs(pendingQuery);
                const pendingCount = pendingSnapshot.size;
                
                document.getElementById('pendingApprovals').textContent = pendingCount;
                document.getElementById('pendingBadge').textContent = pendingCount;
                document.getElementById('headerBadge').textContent = pendingCount;
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }
        
        // Load pending approvals
        async function loadPendingApprovals() {
            try {
                const pendingQuery = query(
                    collection(db, 'providers'),
                    where('status', '==', 'pending')
                );
                
                const snapshot = await getDocs(pendingQuery);
                const container = document.getElementById('pendingApprovalCards');
                container.innerHTML = '';
                
                if (snapshot.empty) {
                    container.innerHTML = `
                        <div class="empty-state" style="grid-column: 1 / -1;">
                            <div class="empty-icon">‚úÖ</div>
                            <div class="empty-title">All caught up!</div>
                            <div class="empty-text">No pending provider approvals at the moment</div>
                        </div>
                    `;
                    return;
                }
                
                snapshot.forEach(docSnap => {
                    const provider = { id: docSnap.id, ...docSnap.data() };
                    const card = createApprovalCard(provider);
                    container.appendChild(card);
                });
            } catch (error) {
                console.error('Error loading pending approvals:', error);
            }
        }
        
        // Create approval card
        function createApprovalCard(provider) {
            const card = document.createElement('div');
            card.className = 'approval-card';
            card.innerHTML = `
                <div class="approval-header">
                    <div class="approval-avatar">${provider.name ? provider.name.charAt(0).toUpperCase() : 'P'}</div>
                    <div class="approval-info">
                        <h4>${provider.name || 'Unknown'}</h4>
                        <p>${provider.email || 'No email'}</p>
                    </div>
                </div>
                <div class="approval-details">
                    <div class="detail-item">
                        <span class="detail-label">Service</span>
                        <span class="detail-value">${formatService(provider.service)}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Hourly Rate</span>
                        <span class="detail-value">‚Ç®${provider.rate || 'Not set'}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Location</span>
                        <span class="detail-value">${provider.location || 'Not set'}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Phone</span>
                        <span class="detail-value">${provider.phone || 'Not set'}</span>
                    </div>
                </div>
                <div class="approval-actions">
                    <button class="btn btn-primary" onclick="approveProvider('${provider.id}')">
                        ‚úì Approve
                    </button>
                    <button class="btn btn-secondary" onclick="rejectProvider('${provider.id}')">
                        ‚úï Reject
                    </button>
                </div>
            `;
            return card;
        }
        
        // Approve provider
        window.approveProvider = async function(providerId) {
            try {
                await updateDoc(doc(db, 'providers', providerId), {
                    status: 'active',
                    approvedAt: new Date().toISOString()
                });
                
                await updateDoc(doc(db, 'users', providerId), {
                    status: 'active'
                });
                
                showToast('Provider approved successfully!', 'success');
                
                // Reload data
                await Promise.all([
                    loadOverviewStats(),
                    loadPendingApprovals(),
                    loadProviders()
                ]);
            } catch (error) {
                console.error('Error approving provider:', error);
                showToast('Failed to approve provider', 'error');
            }
        };
        
        // Reject provider
        window.rejectProvider = async function(providerId) {
            if (!confirm('Are you sure you want to reject this provider?')) return;
            
            try {
                await updateDoc(doc(db, 'providers', providerId), {
                    status: 'rejected',
                    rejectedAt: new Date().toISOString()
                });
                
                await updateDoc(doc(db, 'users', providerId), {
                    status: 'rejected'
                });
                
                showToast('Provider rejected', 'success');
                
                // Reload data
                await Promise.all([
                    loadOverviewStats(),
                    loadPendingApprovals(),
                    loadProviders()
                ]);
            } catch (error) {
                console.error('Error rejecting provider:', error);
                showToast('Failed to reject provider', 'error');
            }
        };
        
        // View provider details
        window.viewProvider = async function(providerId) {
            try {
                const providerDoc = await getDoc(doc(db, 'providers', providerId));
                if (providerDoc.exists()) {
                    const provider = providerDoc.data();
                    alert(`Provider Details:\n\nName: ${provider.name}\nEmail: ${provider.email}\nPhone: ${provider.phone}\nService: ${formatService(provider.service)}\nLocation: ${provider.location}\nRate: ‚Ç®${provider.rate}/hour\nStatus: ${provider.status}\nRating: ${provider.rating || 'N/A'}\nCompleted Jobs: ${provider.completedJobs || 0}`);
                }
            } catch (error) {
                console.error('Error viewing provider:', error);
                showToast('Failed to load provider details', 'error');
            }
        };
        
        // Suspend provider
        window.suspendProvider = async function(providerId) {
            if (!confirm('Are you sure you want to suspend this provider?')) return;
            
            try {
                await updateDoc(doc(db, 'providers', providerId), {
                    status: 'suspended',
                    suspendedAt: new Date().toISOString()
                });
                
                await updateDoc(doc(db, 'users', providerId), {
                    status: 'suspended'
                });
                
                showToast('Provider suspended successfully', 'success');
                await loadProviders();
            } catch (error) {
                console.error('Error suspending provider:', error);
                showToast('Failed to suspend provider', 'error');
            }
        };
        
        // Activate provider
        window.activateProvider = async function(providerId) {
            try {
                await updateDoc(doc(db, 'providers', providerId), {
                    status: 'active',
                    activatedAt: new Date().toISOString()
                });
                
                await updateDoc(doc(db, 'users', providerId), {
                    status: 'active'
                });
                
                showToast('Provider activated successfully', 'success');
                await loadProviders();
            } catch (error) {
                console.error('Error activating provider:', error);
                showToast('Failed to activate provider', 'error');
            }
        };
        
        // Delete provider
        window.deleteProvider = async function(providerId) {
            if (!confirm('‚ö†Ô∏è Are you ABSOLUTELY SURE you want to DELETE this provider?\n\nThis action CANNOT be undone!')) return;
            
            const finalConfirm = confirm('Click OK to permanently delete this provider.');
            if (!finalConfirm) return;
            
            try {
                // Delete from providers collection
                await deleteDoc(doc(db, 'providers', providerId));
                
                // Delete from users collection
                await deleteDoc(doc(db, 'users', providerId));
                
                showToast('Provider deleted successfully', 'success');
                
                // Reload data
                await Promise.all([
                    loadOverviewStats(),
                    loadProviders()
                ]);
            } catch (error) {
                console.error('Error deleting provider:', error);
                showToast('Failed to delete provider', 'error');
            }
        };
        
        // Load all providers
        async function loadProviders() {
            try {
                const snapshot = await getDocs(collection(db, 'providers'));
                const tbody = document.getElementById('providersTable');
                tbody.innerHTML = '';
                
                if (snapshot.empty) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6">
                                <div class="empty-state">
                                    <div class="empty-icon">üë∑</div>
                                    <div class="empty-title">No providers yet</div>
                                </div>
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                snapshot.forEach(docSnap => {
                    const provider = docSnap.data();
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            <div class="user-cell">
                                <div class="user-avatar">${provider.name ? provider.name.charAt(0).toUpperCase() : 'P'}</div>
                                <div class="user-info">
                                    <h4>${provider.name || 'Unknown'}</h4>
                                    <p>${provider.email || 'No email'}</p>
                                </div>
                            </div>
                        </td>
                        <td>${formatService(provider.service)}</td>
                        <td>${provider.location || 'Not set'}</td>
                        <td>‚≠ê ${provider.rating || '5.0'}</td>
                        <td><span class="status-badge ${provider.status || 'pending'}">${provider.status || 'pending'}</span></td>
                        <td>
                            <div class="action-buttons">
                                ${provider.status === 'pending' ? `
                                    <button class="action-btn approve" onclick="approveProvider('${docSnap.id}')" title="Approve">‚úì</button>
                                    <button class="action-btn reject" onclick="rejectProvider('${docSnap.id}')" title="Reject">‚úï</button>
                                ` : provider.status === 'active' ? `
                                    <button class="action-btn" onclick="viewProvider('${docSnap.id}')" title="View Details">üëÅÔ∏è</button>
                                    <button class="action-btn" onclick="suspendProvider('${docSnap.id}')" title="Suspend">‚è∏Ô∏è</button>
                                    <button class="action-btn reject" onclick="deleteProvider('${docSnap.id}')" title="Delete">üóëÔ∏è</button>
                                ` : `
                                    <button class="action-btn" onclick="viewProvider('${docSnap.id}')" title="View Details">üëÅÔ∏è</button>
                                    <button class="action-btn approve" onclick="activateProvider('${docSnap.id}')" title="Activate">‚úì</button>
                                    <button class="action-btn reject" onclick="deleteProvider('${docSnap.id}')" title="Delete">üóëÔ∏è</button>
                                `}
                            </div>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            } catch (error) {
                console.error('Error loading providers:', error);
            }
        }
        
        // Load all customers
        async function loadCustomers() {
            try {
                const snapshot = await getDocs(collection(db, 'customers'));
                const tbody = document.getElementById('customersTable');
                tbody.innerHTML = '';
                
                if (snapshot.empty) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="5">
                                <div class="empty-state">
                                    <div class="empty-icon">üë§</div>
                                    <div class="empty-title">No customers yet</div>
                                </div>
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                snapshot.forEach(docSnap => {
                    const customer = docSnap.data();
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            <div class="user-cell">
                                <div class="user-avatar">${customer.name ? customer.name.charAt(0).toUpperCase() : 'C'}</div>
                                <div class="user-info">
                                    <h4>${customer.name || 'Unknown'}</h4>
                                    <p>${customer.email || 'No email'}</p>
                                </div>
                            </div>
                        </td>
                        <td>${customer.location || 'Not set'}</td>
                        <td>${customer.phone || 'Not set'}</td>
                        <td>${formatDate(customer.createdAt)}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn" onclick="viewCustomer('${docSnap.id}')" title="View Details">üëÅÔ∏è</button>
                                <button class="action-btn reject" onclick="deleteCustomer('${docSnap.id}')" title="Delete">üóëÔ∏è</button>
                            </div>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            } catch (error) {
                console.error('Error loading customers:', error);
            }
        }
        
        // View customer details
        window.viewCustomer = async function(customerId) {
            try {
                const customerDoc = await getDoc(doc(db, 'customers', customerId));
                if (customerDoc.exists()) {
                    const customer = customerDoc.data();
                    alert(`Customer Details:\n\nName: ${customer.name}\nEmail: ${customer.email}\nPhone: ${customer.phone}\nLocation: ${customer.location}\nJoined: ${formatDate(customer.createdAt)}`);
                }
            } catch (error) {
                console.error('Error viewing customer:', error);
                showToast('Failed to load customer details', 'error');
            }
        };
        
        // Delete customer
        window.deleteCustomer = async function(customerId) {
            if (!confirm('‚ö†Ô∏è Are you ABSOLUTELY SURE you want to DELETE this customer?\n\nThis action CANNOT be undone!')) return;
            
            const finalConfirm = confirm('Click OK to permanently delete this customer.');
            if (!finalConfirm) return;
            
            try {
                // Delete from customers collection
                await deleteDoc(doc(db, 'customers', customerId));
                
                // Delete from users collection
                await deleteDoc(doc(db, 'users', customerId));
                
                showToast('Customer deleted successfully', 'success');
                
                // Reload data
                await Promise.all([
                    loadOverviewStats(),
                    loadCustomers()
                ]);
            } catch (error) {
                console.error('Error deleting customer:', error);
                showToast('Failed to delete customer', 'error');
            }
        };
        
        // Load all requests
        async function loadRequests() {
            try {
                const snapshot = await getDocs(collection(db, 'serviceRequests'));
                const tbody = document.getElementById('requestsTable');
                tbody.innerHTML = '';
                
                if (snapshot.empty) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="5">
                                <div class="empty-state">
                                    <div class="empty-icon">üìã</div>
                                    <div class="empty-title">No service requests yet</div>
                                </div>
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                snapshot.forEach(docSnap => {
                    const request = docSnap.data();
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${request.customerName || 'Unknown'}</td>
                        <td>${formatService(request.service)}</td>
                        <td>${request.providerName || 'Not assigned'}</td>
                        <td>${formatDate(request.preferredDate)}</td>
                        <td><span class="status-badge ${request.status}">${request.status}</span></td>
                    `;
                    tbody.appendChild(row);
                });
            } catch (error) {
                console.error('Error loading requests:', error);
            }
        }
        
        // Tab switching
        window.switchTab = function(tab) {
            // Update nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
            
            // Update page title
            const titles = {
                dashboard: 'Dashboard',
                providers: 'Service Providers',
                customers: 'Customers',
                requests: 'Service Requests',
                settings: 'Settings'
            };
            document.getElementById('pageTitle').textContent = titles[tab] || 'Dashboard';
            
            // Update panels
            document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
            document.getElementById(tab + 'Tab').classList.add('active');
        };
        
        // Format helpers
        function formatService(service) {
            const services = {
                plumbing: 'Plumbing',
                electrical: 'Electrical',
                ac: 'AC & Cooling',
                carpentry: 'Carpentry',
                painting: 'Painting',
                cleaning: 'Cleaning',
                appliance: 'Appliance Repair',
                tutoring: 'Home Tutoring',
                other: 'Other'
            };
            return services[service] || service || 'Unknown';
        }
        
        function formatDate(date) {
            if (!date) return 'Unknown';
            return new Date(date).toLocaleDateString('en-PK', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }
        
        // Logout
        window.logout = async function() {
            try {
                await signOut(auth);
                localStorage.removeItem('currentUser');
                window.location.href = 'login-3d.html';
            } catch (error) {
                console.error('Logout error:', error);
            }
        };
        
        // Toast notification
        window.showToast = function(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type} show`;
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        };
        
        // Dark mode toggle
        document.getElementById('darkModeToggle').addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('darkMode', isDark ? 'enabled' : 'disabled');
            document.getElementById('darkModeIcon').textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
        });
        
        // Check saved dark mode preference
        if (localStorage.getItem('darkMode') === 'enabled') {
            document.body.classList.add('dark-mode');
            document.getElementById('darkModeIcon').textContent = '‚òÄÔ∏è';
        }
    </script>
    
    <!-- Security Utilities -->
    <script src="security.js"></script>
    
    <!-- Page Transitions -->
    <script src="page-transitions.js"></script>
</body>
</html>
